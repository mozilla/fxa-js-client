!function(t,e){"function"==typeof define&&define.amd?define([],e):t.FxAccountClient=e()}(this,function(){var t,e,n;return function(r){function o(t,e){return b.call(t,e)}function i(t,e){var n,r,o,i,s,a,c,u,f,h,l=e&&e.split("/"),p=v.map,d=p&&p["*"]||{};if(t&&"."===t.charAt(0))if(e){for(l=l.slice(0,l.length-1),t=l.concat(t.split("/")),u=0;u<t.length;u+=1)if(h=t[u],"."===h)t.splice(u,1),u-=1;else if(".."===h){if(1===u&&(".."===t[2]||".."===t[0]))break;u>0&&(t.splice(u-1,2),u-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((l||d)&&p){for(n=t.split("/"),u=n.length;u>0;u-=1){if(r=n.slice(0,u).join("/"),l)for(f=l.length;f>0;f-=1)if(o=p[l.slice(0,f).join("/")],o&&(o=o[r])){i=o,s=u;break}if(i)break;!a&&d&&d[r]&&(a=d[r],c=u)}!i&&a&&(i=a,s=c),i&&(n.splice(0,s,i),t=n.join("/"))}return t}function s(t,e){return function(){return p.apply(r,T.call(arguments,0).concat([t,e]))}}function a(t){return function(e){return i(e,t)}}function c(t){return function(e){m[t]=e}}function u(t){if(o(y,t)){var e=y[t];delete y[t],w[t]=!0,l.apply(r,e)}if(!o(m,t)&&!o(w,t))throw new Error("No "+t);return m[t]}function f(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function h(t){return function(){return v&&v.config&&v.config[t]||{}}}var l,p,d,g,m={},y={},v={},w={},b=Object.prototype.hasOwnProperty,T=[].slice;d=function(t,e){var n,r=f(t),o=r[0];return t=r[1],o&&(o=i(o,e),n=u(o)),o?t=n&&n.normalize?n.normalize(t,a(e)):i(t,e):(t=i(t,e),r=f(t),o=r[0],t=r[1],o&&(n=u(o))),{f:o?o+"!"+t:t,n:t,pr:o,p:n}},g={require:function(t){return s(t)},exports:function(t){var e=m[t];return"undefined"!=typeof e?e:m[t]={}},module:function(t){return{id:t,uri:"",exports:m[t],config:h(t)}}},l=function(t,e,n,i){var a,f,h,l,p,v,b=[];if(i=i||t,"function"==typeof n){for(e=!e.length&&n.length?["require","exports","module"]:e,p=0;p<e.length;p+=1)if(l=d(e[p],i),f=l.f,"require"===f)b[p]=g.require(t);else if("exports"===f)b[p]=g.exports(t),v=!0;else if("module"===f)a=b[p]=g.module(t);else if(o(m,f)||o(y,f)||o(w,f))b[p]=u(f);else{if(!l.p)throw new Error(t+" missing "+f);l.p.load(l.n,s(i,!0),c(f),{}),b[p]=m[f]}h=n.apply(m[t],b),t&&(a&&a.exports!==r&&a.exports!==m[t]?m[t]=a.exports:h===r&&v||(m[t]=h))}else t&&(m[t]=n)},t=e=p=function(t,e,n,o,i){return"string"==typeof t?g[t]?g[t](e):u(d(t,e).f):(t.splice||(v=t,e.splice?(t=e,e=n,n=null):t=r),e=e||function(){},"function"==typeof n&&(n=o,o=i),o?l(r,t,e,n):setTimeout(function(){l(r,t,e,n)},4),p)},p.config=function(t){return v=t,v.deps&&p(v.deps,v.callback),p},t._defined=m,n=function(t,e,n){e.splice||(n=e,e=[]),o(m,t)||o(y,t)||(y[t]=[t,e,n])},n.amd={jQuery:!0}}(),n("components/almond/almond",function(){}),n("components/sjcl/sjcl",[],function(){function t(t,e,r){if(4!==e.length)throw new n.exception.invalid("invalid aes block size");var o=t.e[r],i=e[0]^o[0],s=e[r?3:1]^o[1],a=e[2]^o[2];e=e[r?1:3]^o[3];var c,u,f,h,l=o.length/4-2,p=4,d=[0,0,0,0];c=t.b[r],t=c[0];var g=c[1],m=c[2],y=c[3],v=c[4];for(h=0;l>h;h++)c=t[i>>>24]^g[255&s>>16]^m[255&a>>8]^y[255&e]^o[p],u=t[s>>>24]^g[255&a>>16]^m[255&e>>8]^y[255&i]^o[p+1],f=t[a>>>24]^g[255&e>>16]^m[255&i>>8]^y[255&s]^o[p+2],e=t[e>>>24]^g[255&i>>16]^m[255&s>>8]^y[255&a]^o[p+3],p+=4,i=c,s=u,a=f;for(h=0;4>h;h++)d[r?3&-h:h]=v[i>>>24]<<24^v[255&s>>16]<<16^v[255&a>>8]<<8^v[255&e]^o[p++],c=i,i=s,s=a,a=e,e=c;return d}function e(t,e){var n,r,o,i=e.slice(0),s=t.f,a=t.e,c=s[0],u=s[1],f=s[2],h=s[3],l=s[4],p=s[5],d=s[6],g=s[7];for(n=0;64>n;n++)16>n?r=i[n]:(r=i[15&n+1],o=i[15&n+14],r=i[15&n]=0|(r>>>7^r>>>18^r>>>3^r<<25^r<<14)+(o>>>17^o>>>19^o>>>10^o<<15^o<<13)+i[15&n]+i[15&n+9]),r=r+g+(l>>>6^l>>>11^l>>>25^l<<26^l<<21^l<<7)+(d^l&(p^d))+a[n],g=d,d=p,p=l,l=0|h+r,h=f,f=u,u=c,c=0|r+(u&f^h&(u^f))+(u>>>2^u>>>13^u>>>22^u<<30^u<<19^u<<10);s[0]=0|s[0]+c,s[1]=0|s[1]+u,s[2]=0|s[2]+f,s[3]=0|s[3]+h,s[4]=0|s[4]+l,s[5]=0|s[5]+p,s[6]=0|s[6]+d,s[7]=0|s[7]+g}var n={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(t){this.toString=function(){return"CORRUPT: "+this.message},this.message=t},invalid:function(t){this.toString=function(){return"INVALID: "+this.message},this.message=t},bug:function(t){this.toString=function(){return"BUG: "+this.message},this.message=t},notReady:function(t){this.toString=function(){return"NOT READY: "+this.message},this.message=t}}};return"undefined"!=typeof module&&module.exports&&(module.exports=n),n.cipher.aes=function(t){this.b[0][0][0]||this.g();var e,r,o,i,s=this.b[0][4],a=this.b[1];e=t.length;var c=1;if(4!==e&&6!==e&&8!==e)throw new n.exception.invalid("invalid aes key size");for(this.e=[o=t.slice(0),i=[]],t=e;4*e+28>t;t++)r=o[t-1],(0===t%e||8===e&&4===t%e)&&(r=s[r>>>24]<<24^s[255&r>>16]<<16^s[255&r>>8]<<8^s[255&r],0===t%e&&(r=r<<8^r>>>24^c<<24,c=c<<1^283*(c>>7))),o[t]=o[t-e]^r;for(e=0;t;e++,t--)r=o[3&e?t:t-4],i[e]=4>=t||4>e?r:a[0][s[r>>>24]]^a[1][s[255&r>>16]]^a[2][s[255&r>>8]]^a[3][s[255&r]]},n.cipher.aes.prototype={encrypt:function(e){return t(this,e,0)},decrypt:function(e){return t(this,e,1)},b:[[[],[],[],[],[]],[[],[],[],[],[]]],g:function(){var t,e,n,r,o,i,s,a=this.b[0],c=this.b[1],u=a[4],f=c[4],h=[],l=[];for(t=0;256>t;t++)l[(h[t]=t<<1^283*(t>>7))^t]=t;for(e=n=0;!u[e];e^=r||1,n=l[n]||1)for(i=n^n<<1^n<<2^n<<3^n<<4,i=99^(i>>8^255&i),u[e]=i,f[i]=e,o=h[t=h[r=h[e]]],s=16843009*o^65537*t^257*r^16843008*e,o=257*h[i]^16843008*i,t=0;4>t;t++)a[t][e]=o=o<<24^o>>>8,c[t][i]=s=s<<24^s>>>8;for(t=0;5>t;t++)a[t]=a[t].slice(0),c[t]=c[t].slice(0)}},n.bitArray={bitSlice:function(t,e,r){return t=n.bitArray.l(t.slice(e/32),32-(31&e)).slice(1),void 0===r?t:n.bitArray.clamp(t,r-e)},extract:function(t,e,n){var r=Math.floor(31&-e-n);return(-32&(e+n-1^e)?t[0|e/32]<<32-r^t[0|e/32+1]>>>r:t[0|e/32]>>>r)&(1<<n)-1},concat:function(t,e){if(0===t.length||0===e.length)return t.concat(e);var r=t[t.length-1],o=n.bitArray.getPartial(r);return 32===o?t.concat(e):n.bitArray.l(e,o,0|r,t.slice(0,t.length-1))},bitLength:function(t){var e=t.length;return 0===e?0:32*(e-1)+n.bitArray.getPartial(t[e-1])},clamp:function(t,e){if(32*t.length<e)return t;t=t.slice(0,Math.ceil(e/32));var r=t.length;return e&=31,r>0&&e&&(t[r-1]=n.bitArray.partial(e,t[r-1]&2147483648>>e-1,1)),t},partial:function(t,e,n){return 32===t?e:(n?0|e:e<<32-t)+1099511627776*t},getPartial:function(t){return Math.round(t/1099511627776)||32},equal:function(t,e){if(n.bitArray.bitLength(t)!==n.bitArray.bitLength(e))return!1;var r,o=0;for(r=0;r<t.length;r++)o|=t[r]^e[r];return 0===o},l:function(t,e,r,o){var i;for(i=0,void 0===o&&(o=[]);e>=32;e-=32)o.push(r),r=0;if(0===e)return o.concat(t);for(i=0;i<t.length;i++)o.push(r|t[i]>>>e),r=t[i]<<32-e;return i=t.length?t[t.length-1]:0,t=n.bitArray.getPartial(i),o.push(n.bitArray.partial(31&e+t,e+t>32?r:o.pop(),1)),o},n:function(t,e){return[t[0]^e[0],t[1]^e[1],t[2]^e[2],t[3]^e[3]]}},n.codec.utf8String={fromBits:function(t){var e,r,o="",i=n.bitArray.bitLength(t);for(e=0;i/8>e;e++)0===(3&e)&&(r=t[e/4]),o+=String.fromCharCode(r>>>24),r<<=8;return decodeURIComponent(escape(o))},toBits:function(t){t=unescape(encodeURIComponent(t));var e,r=[],o=0;for(e=0;e<t.length;e++)o=o<<8|t.charCodeAt(e),3===(3&e)&&(r.push(o),o=0);return 3&e&&r.push(n.bitArray.partial(8*(3&e),o)),r}},n.codec.hex={fromBits:function(t){var e,r="";for(e=0;e<t.length;e++)r+=((0|t[e])+0xf00000000000).toString(16).substr(4);return r.substr(0,n.bitArray.bitLength(t)/4)},toBits:function(t){var e,r,o=[];for(t=t.replace(/\s|0x/g,""),r=t.length,t+="00000000",e=0;e<t.length;e+=8)o.push(0^parseInt(t.substr(e,8),16));return n.bitArray.clamp(o,4*r)}},n.codec.base64={i:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(t,e,r){var o="",i=0,s=n.codec.base64.i,a=0,c=n.bitArray.bitLength(t);for(r&&(s=s.substr(0,62)+"-_"),r=0;6*o.length<c;)o+=s.charAt((a^t[r]>>>i)>>>26),6>i?(a=t[r]<<6-i,i+=26,r++):(a<<=6,i-=6);for(;3&o.length&&!e;)o+="=";return o},toBits:function(t,e){t=t.replace(/\s|=/g,"");var r,o,i=[],s=0,a=n.codec.base64.i,c=0;for(e&&(a=a.substr(0,62)+"-_"),r=0;r<t.length;r++){if(o=a.indexOf(t.charAt(r)),0>o)throw new n.exception.invalid("this isn't base64!");s>26?(s-=26,i.push(c^o>>>s),c=o<<32-s):(s+=6,c^=o<<32-s)}return 56&s&&i.push(n.bitArray.partial(56&s,c,1)),i}},n.codec.base64url={fromBits:function(t){return n.codec.base64.fromBits(t,1,1)},toBits:function(t){return n.codec.base64.toBits(t,1)}},n.hash.sha256=function(t){this.e[0]||this.g(),t?(this.f=t.f.slice(0),this.d=t.d.slice(0),this.a=t.a):this.reset()},n.hash.sha256.hash=function(t){return(new n.hash.sha256).update(t).finalize()},n.hash.sha256.prototype={blockSize:512,reset:function(){return this.f=this.k.slice(0),this.d=[],this.a=0,this},update:function(t){"string"==typeof t&&(t=n.codec.utf8String.toBits(t));var r,o=this.d=n.bitArray.concat(this.d,t);for(r=this.a,t=this.a=r+n.bitArray.bitLength(t),r=-512&512+r;t>=r;r+=512)e(this,o.splice(0,16));return this},finalize:function(){var t,r=this.d,o=this.f,r=n.bitArray.concat(r,[n.bitArray.partial(1,1)]);for(t=r.length+2;15&t;t++)r.push(0);for(r.push(Math.floor(this.a/4294967296)),r.push(0|this.a);r.length;)e(this,r.splice(0,16));return this.reset(),o},k:[],e:[],g:function(){function t(t){return 0|4294967296*(t-Math.floor(t))}var e,n=0,r=2;t:for(;64>n;r++){for(e=2;r>=e*e;e++)if(0===r%e)continue t;8>n&&(this.k[n]=t(Math.pow(r,.5))),this.e[n]=t(Math.pow(r,1/3)),n++}}},n.misc.hmac=function(t,e){this.j=e=e||n.hash.sha256;var r,o=[[],[]],i=e.prototype.blockSize/32;for(this.c=[new e,new e],t.length>i&&(t=e.hash(t)),r=0;i>r;r++)o[0][r]=909522486^t[r],o[1][r]=1549556828^t[r];this.c[0].update(o[0]),this.c[1].update(o[1]),this.h=new e(this.c[0])},n.misc.hmac.prototype.encrypt=n.misc.hmac.prototype.mac=function(t){if(this.m)throw new n.exception.invalid("encrypt on already updated hmac called!");return this.update(t),this.digest(t)},n.misc.hmac.prototype.reset=function(){this.h=new this.j(this.c[0]),this.m=!1},n.misc.hmac.prototype.update=function(t){this.m=!0,this.h.update(t)},n.misc.hmac.prototype.digest=function(){var t=this.h.finalize(),t=new this.j(this.c[1]).update(t).finalize();return this.reset(),t},n.misc.pbkdf2=function(t,e,r,o,i){if(r=r||1e3,0>o||0>r)throw n.exception.invalid("invalid params to pbkdf2");"string"==typeof t&&(t=n.codec.utf8String.toBits(t)),"string"==typeof e&&(e=n.codec.utf8String.toBits(e)),i=i||n.misc.hmac,t=new i(t);var s,a,c,u,f=[],h=n.bitArray;for(u=1;32*f.length<(o||1);u++){for(i=s=t.encrypt(h.concat(e,[u])),a=1;r>a;a++)for(s=t.encrypt(s),c=0;c<s.length;c++)i[c]^=s[c];f=f.concat(i)}return o&&(f=h.clamp(f,o)),f},n}),n("client/lib/hawk",["../../components/sjcl/sjcl"],function(t){var e={};return e.client={header:function(t,n,r){var o={field:"",artifacts:{}};if(!t||"string"!=typeof t&&"object"!=typeof t||!n||"string"!=typeof n||!r||"object"!=typeof r)return o.err="Invalid argument type",o;var i=r.timestamp||Math.floor((e.utils.now()+(r.localtimeOffsetMsec||0))/1e3),s=r.credentials;if(!(s&&s.id&&s.key&&s.algorithm))return o.err="Invalid credential object",o;if(-1===e.crypto.algorithms.indexOf(s.algorithm))return o.err="Unknown algorithm",o;"string"==typeof t&&(t=e.utils.parseUri(t));var a={ts:i,nonce:r.nonce||e.utils.randomString(6),method:n,resource:t.relative,host:t.hostname,port:t.port,hash:r.hash,ext:r.ext,app:r.app,dlg:r.dlg};o.artifacts=a,!a.hash&&r.hasOwnProperty("payload")&&(a.hash=e.crypto.calculatePayloadHash(r.payload,s.algorithm,r.contentType));var c=e.crypto.calculateMac("header",s,a),u=null!==a.ext&&void 0!==a.ext&&""!==a.ext,f='Hawk id="'+s.id+'", ts="'+a.ts+'", nonce="'+a.nonce+(a.hash?'", hash="'+a.hash:"")+(u?'", ext="'+e.utils.escapeHeaderAttribute(a.ext):"")+'", mac="'+c+'"';return a.app&&(f+=', app="'+a.app+(a.dlg?'", dlg="'+a.dlg:"")+'"'),o.field=f,o},authenticate:function(t,n,r,o){if(o=o||{},t.getResponseHeader("www-authenticate")){var i=e.utils.parseAuthorizationHeader(t.getResponseHeader("www-authenticate"),["ts","tsm","error"]);if(!i)return!1;if(i.ts){var s=e.crypto.calculateTsMac(i.ts,n);if(s!==i.tsm)return!1;e.utils.setNtpOffset(i.ts-Math.floor((new Date).getTime()/1e3))}}if(!t.getResponseHeader("server-authorization")&&!o.required)return!0;var a=e.utils.parseAuthorizationHeader(t.getResponseHeader("server-authorization"),["mac","ext","hash"]);if(!a)return!1;var c={ts:r.ts,nonce:r.nonce,method:r.method,resource:r.resource,host:r.host,port:r.port,hash:a.hash,ext:a.ext,app:r.app,dlg:r.dlg},u=e.crypto.calculateMac("response",n,c);if(u!==a.mac)return!1;if(!o.hasOwnProperty("payload"))return!0;if(!a.hash)return!1;var f=e.crypto.calculatePayloadHash(o.payload,n.algorithm,t.getResponseHeader("content-type"));return f===a.hash},message:function(t,n,r,o){if(!t||"string"!=typeof t||!n||"number"!=typeof n||null===r||void 0===r||"string"!=typeof r||!o||"object"!=typeof o)return null;var i=o.timestamp||Math.floor((e.utils.now()+(o.localtimeOffsetMsec||0))/1e3),s=o.credentials;if(!(s&&s.id&&s.key&&s.algorithm))return null;if(-1===e.crypto.algorithms.indexOf(s.algorithm))return null;var a={ts:i,nonce:o.nonce||e.utils.randomString(6),host:t,port:n,hash:e.crypto.calculatePayloadHash(r,s.algorithm)},c={id:s.id,ts:a.ts,nonce:a.nonce,hash:a.hash,mac:e.crypto.calculateMac("message",s,a)};return c},authenticateTimestamp:function(t,n,r){var o=e.crypto.calculateTsMac(t.ts,n);return o!==t.tsm?!1:(r!==!1&&e.utils.setNtpOffset(t.ts-Math.floor((new Date).getTime()/1e3)),!0)}},e.crypto={headerVersion:"1",algorithms:["sha1","sha256"],calculateMac:function(n,r,o){var i=e.crypto.generateNormalizedString(n,o),s=new t.misc.hmac(r.key,t.hash.sha256);return s.update(i),t.codec.base64.fromBits(s.digest())},generateNormalizedString:function(t,n){var r="hawk."+e.crypto.headerVersion+"."+t+"\n"+n.ts+"\n"+n.nonce+"\n"+(n.method||"").toUpperCase()+"\n"+(n.resource||"")+"\n"+n.host.toLowerCase()+"\n"+n.port+"\n"+(n.hash||"")+"\n";return n.ext&&(r+=n.ext.replace("\\","\\\\").replace("\n","\\n")),r+="\n",n.app&&(r+=n.app+"\n"+(n.dlg||"")+"\n"),r},calculatePayloadHash:function(n,r,o){var i=new t.hash.sha256;return i.update("hawk."+e.crypto.headerVersion+".payload\n").update(e.utils.parseContentType(o)+"\n").update(n||"").update("\n"),t.codec.base64.fromBits(i.finalize())},calculateTsMac:function(n,r){var o=new t.misc.hmac(r.key,t.hash.sha256);return o.update("hawk."+e.crypto.headerVersion+".ts\n"+n+"\n"),t.codec.base64.fromBits(o.digest())}},e.utils={storage:{_cache:{},setItem:function(t,n){e.utils.storage._cache[t]=n},getItem:function(t){return e.utils.storage._cache[t]}},setStorage:function(t){var n=e.utils.getNtpOffset()||0;e.utils.storage=t,e.utils.setNtpOffset(n)},setNtpOffset:function(t){try{e.utils.storage.setItem("hawk_ntp_offset",t)}catch(n){console.error("[hawk] could not write to storage."),console.error(n)}},getNtpOffset:function(){return parseInt(e.utils.storage.getItem("hawk_ntp_offset")||"0",10)},now:function(){return(new Date).getTime()+e.utils.getNtpOffset()},escapeHeaderAttribute:function(t){return t.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')},parseContentType:function(t){return t?t.split(";")[0].replace(/^\s+|\s+$/g,"").toLowerCase():""},parseAuthorizationHeader:function(t,e){if(!t)return null;var n=t.match(/^(\w+)(?:\s+(.*))?$/);if(!n)return null;var r=n[1];if("hawk"!==r.toLowerCase())return null;var o=n[2];if(!o)return null;var i={},s=o.replace(/(\w+)="([^"\\]*)"\s*(?:,\s*|$)/g,function(t,n,r){return-1===e.indexOf(n)||null===r.match(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~]+$/)||i.hasOwnProperty(n)?void 0:(i[n]=r,"")});return""!==s?null:i},randomString:function(t){for(var e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",n=e.length,r=[],o=0;t>o;++o)r[o]=e[Math.floor(Math.random()*n)];return r.join("")},parseUri:function(t){for(var e=["source","protocol","authority","userInfo","user","password","hostname","port","resource","relative","pathname","directory","file","query","fragment"],n=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?(((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?)(?:#(.*))?)/,r=n.exec(t),o={},i=15;i--;)o[e[i]]=r[i]||"";return(null===o.port||""===o.port)&&(o.port="http"===o.protocol.toLowerCase()?"80":"https"===o.protocol.toLowerCase()?"443":""),o}},e}),function(t){"undefined"!=typeof module&&module&&module.exports?module.exports=t():"function"==typeof n&&n.amd?n("components/p/p",t):P=t()}(function(){function t(){for(;v.n;){v=v.n;var t=v.f;v.f=null,t()}b=!1}function e(t){return"object"===t||"function"===t}function n(t,e){for(var n=0,r=t.length;r>n;++n)n in t&&e(t[n],n)}function r(t){try{if(!o.onerror)throw t;o.onerror(t)}catch(e){setTimeout(function(){throw e},0)}}function o(t){return t instanceof h?t:a(new h,t)}function i(t,e,r){return t._state?t:(t._state=e,t._value=r,t._pending.length>0&&n(t._pending,_),t._pending=null,t)}function s(t,e){t._pending.push(e)}function a(t,e){return t._state?t:(e instanceof h?e===t?i(t,C,new TypeError("You can't resolve a promise with itself")):e._state?i(t,e._state,e._value):s(e,function(){i(t,e._state,e._value)}):e!==Object(e)?i(t,S,e):_(function(){var n=c(t);try{var r=e.then;"function"==typeof r?k.call(r,e,n.resolve,n.reject):i(t,S,e)}catch(o){n.reject(o)}}),t)}function c(t){var e=!1;return{promise:t,resolve:function(n){e||(e=!0,a(t,n))},reject:function(n){e||(e=!0,i(t,C,n))}}}function u(){return c(new h)}function f(t){return i(new h,C,t)}function h(){this._state=0,this._value=void 0,this._pending=[]}function l(t){function e(e){return t(e,[])}function n(t){return o(t).then(e)}return n._=t,n}function p(t,e){var r=0,a=new h;return n(t,function(t,n){var c=o(t);c._state===A?(++r,s(c,function(){e[n]=c.inspect(),0===--r&&i(a,S,e)})):e[n]=c.inspect()}),0===r&&i(a,S,e),a}function d(t,e){var r=0,i=u();return n(t,function(t,n){var s=o(t);s._state===S?e[n]=s._value:(++r,s.then(function(t){e[n]=t,0===--r&&i.resolve(e)},i.reject))}),0===r&&i.resolve(e),i.promise}function g(t){function e(e){return x.apply(t,e)}return function(){var t=d(arguments,[]);return d([this,t],[]).then(e)}}var m,y,v={f:null,n:null},w=v,b=!1,T=e(typeof window)&&window||e(typeof worker)&&worker,k=e.call,x=e.apply,_=function(e){w=w.n={f:e,n:null},b||(b=!0,y(t,0))};e(typeof process)&&process&&process.nextTick?y=process.nextTick:e(typeof setImmediate)?y=T?function(t){T.setImmediate(t)}:function(t){setImmediate(t)}:e(typeof MessageChannel)?(m=new MessageChannel,m.port1.onmessage=t,y=function(){m.port2.postMessage(0)}):(y=setTimeout,T&&e(typeof Image)&&Image&&!function(){var t=0,e=function(t){var e=new Image;e.onerror=t,e.src="data:image/png,"};try{e(function(){0===--t&&(y=e)}),++t}catch(n){}t&&setTimeout(function(){t=0},0)}());var A=0,S=1,C=2;return o.defer=u,o.reject=f,h.prototype.then=function(t,e){function n(){var t,e=c._state===S?r:o;if(null!==e){try{t=e(c._value)}catch(n){return i(u,C,n),void 0}a(u,t)}else i(u,c._state,c._value)}var r="function"==typeof t?t:null,o="function"==typeof e?e:null,c=this,u=new h;return c._state===A?s(c,n):_(n),u},h.prototype.done=function(t,e){var n=this;(t||e)&&(n=n.then(t,e)),n.then(null,r)},h.prototype.fail=function(t){return this.then(null,t)},h.prototype.spread=function(t,e){return this.then(t&&function(n){return d(n,[]).then(function(e){return x.call(t,void 0,e)},e)},e)},h.prototype.timeout=function(t,e){var n=this,r=new h;if(n._state!==A)i(r,n._state,n._value);else{var o=setTimeout(function(){i(r,C,new Error(e||"Timed out after "+t+" ms"))},t);s(n,function(){clearTimeout(o),i(r,n._state,n._value)})}return r},h.prototype.delay=function(t){var e=u();return this.then(function(n){setTimeout(function(){e.resolve(n)},t)},e.reject),e.promise},h.prototype.inspect=function(){switch(this._state){case A:return{state:"pending"};case S:return{state:"fulfilled",value:this._value};case C:return{state:"rejected",reason:this._value};default:throw new TypeError("invalid state")}},o.allSettled=l(p),o.all=l(d),o.promised=g,o.onerror=null,o.nextTick=function(t){_(function(){try{t()}catch(e){setTimeout(function(){throw e},0)}})},o}),n("client/lib/errors",[],function(){return{INVALID_TIMESTAMP:111,INCORRECT_EMAIL_CASE:120}}),n("client/lib/request",["./hawk","../../components/p/p","./errors"],function(t,e,n){function r(t,e,n){n||(n={}),this.baseUri=t,this._localtimeOffsetMsec=n.localtimeOffsetMsec,this.xhr=e||XMLHttpRequest}return r.prototype.send=function(r,o,i,s,a){var c,u=e.defer(),f=new this.xhr,h=this.baseUri+r,l=this;a=a||{},s&&(c=JSON.stringify(s));try{f.open(o,h)}catch(p){u.reject({error:"Unknown error",message:p.toString(),errno:999})}if(f.onerror=function(){u.reject(f.responseText)},f.onload=function(){var t=f.responseText;try{t=JSON.parse(f.responseText)}catch(e){}if(t.errno){if(t.errno!==n.INVALID_TIMESTAMP||a.retrying)return u.reject(t);var c=t.serverTime;return l._localtimeOffsetMsec=1e3*c-(new Date).getTime(),a.retrying=!0,l.send(r,o,i,s,a).then(u.resolve,u.reject)}u.resolve(t)},i){var d=t.client.header(h,o,{credentials:i,payload:c,contentType:"application/json",localtimeOffsetMsec:this._localtimeOffsetMsec||0});f.setRequestHeader("authorization",d.field)}if(f.setRequestHeader("Content-Type","application/json"),a&&a.headers)for(var g in a.headers)f.setRequestHeader(g,a.headers[g]);return f.send(c),u.promise},r}),n("client/lib/hkdf",["../../components/sjcl/sjcl","../../components/p/p"],function(t,e){function n(n,r,o,i){var s=new t.misc.hmac(o,t.hash.sha256);s.update(n);for(var a=s.digest(),c=[],u=32,f=Math.ceil(i/u),h=t.codec.hex.toBits(""),l=0;f>l;l++){var p=new t.misc.hmac(a,t.hash.sha256),d=t.bitArray.concat(t.bitArray.concat(h,r),t.codec.utf8String.toBits(String.fromCharCode(l+1)));p.update(d),h=p.digest(),c.push(h)}var g=c[0];c.length>1&&(g=t.bitArray.concat.apply(null,c));var m=t.bitArray.clamp(g,8*i);return e(m)}return n}),n("client/lib/pbkdf2",["../../components/sjcl/sjcl","../../components/p/p"],function(t,e){var n={derive:function(n,r,o,i){var s=t.misc.pbkdf2(n,r,o,i,t.misc.hmac);return e(s)}};return n}),n("client/lib/credentials",["./request","../../components/sjcl/sjcl","../../components/p/p","./hkdf","./pbkdf2"],function(t,e,n,r,o){function i(t,n){return e.codec.utf8String.toBits(a+t+":"+n)}function s(t){return e.codec.utf8String.toBits(a+t)}var a="identity.mozilla.com/picl/v1/",c=1e3,u=256,f=e.codec.hex.toBits("00"),h=32;return{setup:function(t,n){var a={},l=i("quickStretch",t),p=e.codec.utf8String.toBits(n);return a.emailUTF8=t,a.passwordUTF8=n,o.derive(p,l,c,u).then(function(t){return a.quickStretchedPW=t,r(t,s("authPW"),f,h).then(function(e){return a.authPW=e,r(t,s("unwrapBkey"),f,h)})}).then(function(t){return a.unwrapBKey=t,a})},wrap:function(t,e){for(var n=[],r=0;r<t.length;r++)n[r]=t[r]^e[r];return n}}}),n("client/lib/hawkCredentials",["../../components/sjcl/sjcl","./hkdf"],function(t,e){function n(n,s,a){var c=t.codec.hex.toBits(n),u=t.codec.utf8String.toBits(r+s);return e(c,u,i,a||96).then(function(e){var n=o(e,256,512),r=o(e,512);return{algorithm:"sha256",id:t.codec.hex.fromBits(o(e,0,256)),key:n,bundleKey:r}})}var r="identity.mozilla.com/picl/v1/",o=t.bitArray.bitSlice,i=t.codec.hex.toBits("");return n}),n("client/FxAccountClient",["./lib/request","../components/sjcl/sjcl","./lib/credentials","./lib/hawkCredentials","./lib/errors"],function(t,e,n,r,o){function i(e,n){"string"!=typeof e&&(n=e||{},e=n.uri),"undefined"==typeof n&&(n={}),this.request=new t(e,n.xhr,{localtimeOffsetMsec:n.localtimeOffsetMsec})}return i.prototype.signUp=function(t,r,o){var i=this;return n.setup(t,r).then(function(t){var n="/account/create",r={email:t.emailUTF8,authPW:e.codec.hex.fromBits(t.authPW)},s={};return o&&(o.service&&(r.service=o.service),o.redirectTo&&(r.redirectTo=o.redirectTo),o.preVerified&&(r.preVerified=o.preVerified),o.keys&&(n+="?keys=true"),o.lang&&(s.headers={"Accept-Language":o.lang})),i.request.send(n,"POST",null,r,s)})},i.prototype.signIn=function(t,r,i){var s=this;return i=i||{},n.setup(t,r).then(function(t){var n="/account/login",a={email:t.emailUTF8,authPW:e.codec.hex.fromBits(t.authPW)};return i.keys&&(n+="?keys=true"),s.request.send(n,"POST",null,a).then(function(n){return i.keys&&(n.unwrapBKey=e.codec.hex.fromBits(t.unwrapBKey)),n},function(t){if(t&&t.email&&t.errno===o.INCORRECT_EMAIL_CASE&&!i.skipCaseError)return i.skipCaseError=!0,s.signIn(t.email,r,i);throw t})})},i.prototype.verifyCode=function(t,e){return this.request.send("/recovery_email/verify_code","POST",null,{uid:t,code:e})},i.prototype.recoveryEmailStatus=function(t){var e=this;return r(t,"sessionToken",64).then(function(t){return e.request.send("/recovery_email/status","GET",t)})},i.prototype.recoveryEmailResendCode=function(t,e){var n=this,o={},i={};return e&&(e.service&&(o.service=e.service),e.redirectTo&&(o.redirectTo=e.redirectTo),e.lang&&(i.headers={"Accept-Language":e.lang})),r(t,"sessionToken",64).then(function(t){return n.request.send("/recovery_email/resend_code","POST",t,o,i)})},i.prototype.passwordForgotSendCode=function(t,e){var n={email:t},r={};return e&&(e.service&&(n.service=e.service),e.redirectTo&&(n.redirectTo=e.redirectTo),e.lang&&(r.headers={"Accept-Language":e.lang})),this.request.send("/password/forgot/send_code","POST",null,n,r)},i.prototype.passwordForgotResendCode=function(t,e,n){var o=this,i={email:t},s={};return n&&(n.service&&(i.service=n.service),n.redirectTo&&(i.redirectTo=n.redirectTo),n.lang&&(s.headers={"Accept-Language":n.lang})),r(e,"passwordForgotToken",64).then(function(t){return o.request.send("/password/forgot/resend_code","POST",t,i,s)})},i.prototype.passwordForgotVerifyCode=function(t,e){var n=this;return r(e,"passwordForgotToken",64).then(function(e){return n.request.send("/password/forgot/verify_code","POST",e,{code:t})})},i.prototype.accountReset=function(t,o,i){var s,a=this;return n.setup(t,o).then(function(t){return s=e.codec.hex.fromBits(t.authPW),r(i,"accountResetToken",64)}).then(function(t){return a.request.send("/account/reset","POST",t,{authPW:s})})},i.prototype.accountKeys=function(t){var e=this;return r(t,"keyFetchToken",64).then(function(t){return e.request.send("/account/keys","GET",t)})},i.prototype.accountDevices=function(t){var e=this;return r(t,"sessionToken",64).then(function(t){return e.request.send("/account/devices","GET",t)})},i.prototype.accountDestroy=function(t,r,i){var s=this;return i=i||{},n.setup(t,r).then(function(t){var n={email:t.emailUTF8,authPW:e.codec.hex.fromBits(t.authPW)};return s.request.send("/account/destroy","POST",null,n).then(function(t){return t},function(t){if(t&&t.email&&t.errno===o.INCORRECT_EMAIL_CASE&&!i.skipCaseError)return i.skipCaseError=!0,s.accountDestroy(t.email,r,i);throw t})})},i.prototype.sessionDestroy=function(t){var e=this;return r(t,"sessionToken",64).then(function(t){return e.request.send("/session/destroy","POST",t)})},i.prototype.certificateSign=function(t,e,n){var o=this,i={publicKey:e,duration:n};return r(t,"sessionToken",64).then(function(t){return o.request.send("/certificate/sign","POST",t,i)})},i.prototype.passwordChange=function(t,e,n){var r=this;return r._passwordChangeStart(t,e).then(function(e){return r._passwordChangeFinish(t,n,e)})},i.prototype._passwordChangeStart=function(t,r,i){var s=this;return i=i||{},n.setup(t,r).then(function(t){var n={email:t.emailUTF8,oldAuthPW:e.codec.hex.fromBits(t.authPW)};return s.request.send("/password/change/start","POST",null,n).then(function(n){return n.oldUnwrapBKey=e.codec.hex.fromBits(t.unwrapBKey),n},function(t){if(t&&t.email&&t.errno===o.INCORRECT_EMAIL_CASE&&!i.skipCaseError)return i.skipCaseError=!0,s._passwordChangeStart(t.email,r,i);throw t})})},i.prototype._passwordChangeFinish=function(t,o,i){var s,a,c=this;return n.setup(t,o).then(function(t){return s=e.codec.hex.fromBits(n.wrap(e.codec.hex.toBits(i.oldUnwrapBKey),t.unwrapBKey)),a=e.codec.hex.fromBits(t.authPW),r(i.passwordChangeToken,"passwordChangeToken",64)}).then(function(t){return c.request.send("/password/change/finish","POST",t,{wrapKb:s,authPW:a})})},i.prototype.getRandomBytes=function(){return this.request.send("/get_random_bytes","POST")},i}),t("client/FxAccountClient")});
//# sourceMappingURL=fxa-client.min.js.map