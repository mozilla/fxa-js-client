!function(e,t){"function"==typeof define&&define.amd?define([],t):e.FxAccountClient=t()}(this,function(){var e,t,r;return function(n){function o(e,t){return b.call(e,t)}function i(e,t){var r,n,o,i,s,a,c,u,f,h,l,p=t&&t.split("/"),d=v.map,g=d&&d["*"]||{};if(e&&"."===e.charAt(0))if(t){for(p=p.slice(0,p.length-1),e=e.split("/"),s=e.length-1,v.nodeIdCompat&&k.test(e[s])&&(e[s]=e[s].replace(k,"")),e=p.concat(e),f=0;f<e.length;f+=1)if(l=e[f],"."===l)e.splice(f,1),f-=1;else if(".."===l){if(1===f&&(".."===e[2]||".."===e[0]))break;f>0&&(e.splice(f-1,2),f-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||g)&&d){for(r=e.split("/"),f=r.length;f>0;f-=1){if(n=r.slice(0,f).join("/"),p)for(h=p.length;h>0;h-=1)if(o=d[p.slice(0,h).join("/")],o&&(o=o[n])){i=o,a=f;break}if(i)break;!c&&g&&g[n]&&(c=g[n],u=f)}!i&&c&&(i=c,a=u),i&&(r.splice(0,a,i),e=r.join("/"))}return e}function s(e,t){return function(){return p.apply(n,T.call(arguments,0).concat([e,t]))}}function a(e){return function(t){return i(t,e)}}function c(e){return function(t){y[e]=t}}function u(e){if(o(m,e)){var t=m[e];delete m[e],w[e]=!0,l.apply(n,t)}if(!o(y,e)&&!o(w,e))throw new Error("No "+e);return y[e]}function f(e){var t,r=e?e.indexOf("!"):-1;return r>-1&&(t=e.substring(0,r),e=e.substring(r+1,e.length)),[t,e]}function h(e){return function(){return v&&v.config&&v.config[e]||{}}}var l,p,d,g,y={},m={},v={},w={},b=Object.prototype.hasOwnProperty,T=[].slice,k=/\.js$/;d=function(e,t){var r,n=f(e),o=n[0];return e=n[1],o&&(o=i(o,t),r=u(o)),o?e=r&&r.normalize?r.normalize(e,a(t)):i(e,t):(e=i(e,t),n=f(e),o=n[0],e=n[1],o&&(r=u(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:r}},g={require:function(e){return s(e)},exports:function(e){var t=y[e];return"undefined"!=typeof t?t:y[e]={}},module:function(e){return{id:e,uri:"",exports:y[e],config:h(e)}}},l=function(e,t,r,i){var a,f,h,l,p,v,b=[],T=typeof r;if(i=i||e,"undefined"===T||"function"===T){for(t=!t.length&&r.length?["require","exports","module"]:t,p=0;p<t.length;p+=1)if(l=d(t[p],i),f=l.f,"require"===f)b[p]=g.require(e);else if("exports"===f)b[p]=g.exports(e),v=!0;else if("module"===f)a=b[p]=g.module(e);else if(o(y,f)||o(m,f)||o(w,f))b[p]=u(f);else{if(!l.p)throw new Error(e+" missing "+f);l.p.load(l.n,s(i,!0),c(f),{}),b[p]=y[f]}h=r?r.apply(y[e],b):void 0,e&&(a&&a.exports!==n&&a.exports!==y[e]?y[e]=a.exports:h===n&&v||(y[e]=h))}else e&&(y[e]=r)},e=t=p=function(e,t,r,o,i){if("string"==typeof e)return g[e]?g[e](t):u(d(e,t).f);if(!e.splice){if(v=e,v.deps&&p(v.deps,v.callback),!t)return;t.splice?(e=t,t=r,r=null):e=n}return t=t||function(){},"function"==typeof r&&(r=o,o=i),o?l(n,e,t,r):setTimeout(function(){l(n,e,t,r)},4),p},p.config=function(e){return p(e)},e._defined=y,r=function(e,t,r){t.splice||(r=t,t=[]),o(y,e)||o(m,e)||(m[e]=[e,t,r])},r.amd={jQuery:!0}}(),r("components/almond/almond",function(){}),r("sjcl",[],function(){function e(e,t,n){if(4!==t.length)throw new r.exception.invalid("invalid aes block size");var o=e.e[n],i=t[0]^o[0],s=t[n?3:1]^o[1],a=t[2]^o[2];t=t[n?1:3]^o[3];var c,u,f,h,l=o.length/4-2,p=4,d=[0,0,0,0];c=e.b[n],e=c[0];var g=c[1],y=c[2],m=c[3],v=c[4];for(h=0;l>h;h++)c=e[i>>>24]^g[s>>16&255]^y[a>>8&255]^m[255&t]^o[p],u=e[s>>>24]^g[a>>16&255]^y[t>>8&255]^m[255&i]^o[p+1],f=e[a>>>24]^g[t>>16&255]^y[i>>8&255]^m[255&s]^o[p+2],t=e[t>>>24]^g[i>>16&255]^y[s>>8&255]^m[255&a]^o[p+3],p+=4,i=c,s=u,a=f;for(h=0;4>h;h++)d[n?3&-h:h]=v[i>>>24]<<24^v[s>>16&255]<<16^v[a>>8&255]<<8^v[255&t]^o[p++],c=i,i=s,s=a,a=t,t=c;return d}function t(e,t){var r,n,o,i=t.slice(0),s=e.f,a=e.e,c=s[0],u=s[1],f=s[2],h=s[3],l=s[4],p=s[5],d=s[6],g=s[7];for(r=0;64>r;r++)16>r?n=i[r]:(n=i[r+1&15],o=i[r+14&15],n=i[15&r]=(n>>>7^n>>>18^n>>>3^n<<25^n<<14)+(o>>>17^o>>>19^o>>>10^o<<15^o<<13)+i[15&r]+i[r+9&15]|0),n=n+g+(l>>>6^l>>>11^l>>>25^l<<26^l<<21^l<<7)+(d^l&(p^d))+a[r],g=d,d=p,p=l,l=h+n|0,h=f,f=u,u=c,c=n+(u&f^h&(u^f))+(u>>>2^u>>>13^u>>>22^u<<30^u<<19^u<<10)|0;s[0]=s[0]+c|0,s[1]=s[1]+u|0,s[2]=s[2]+f|0,s[3]=s[3]+h|0,s[4]=s[4]+l|0,s[5]=s[5]+p|0,s[6]=s[6]+d|0,s[7]=s[7]+g|0}var r={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};return"undefined"!=typeof module&&module.exports&&(module.exports=r),r.cipher.aes=function(e){this.b[0][0][0]||this.g();var t,n,o,i,s=this.b[0][4],a=this.b[1];t=e.length;var c=1;if(4!==t&&6!==t&&8!==t)throw new r.exception.invalid("invalid aes key size");for(this.e=[o=e.slice(0),i=[]],e=t;4*t+28>e;e++)n=o[e-1],(0===e%t||8===t&&4===e%t)&&(n=s[n>>>24]<<24^s[n>>16&255]<<16^s[n>>8&255]<<8^s[255&n],0===e%t&&(n=n<<8^n>>>24^c<<24,c=c<<1^283*(c>>7))),o[e]=o[e-t]^n;for(t=0;e;t++,e--)n=o[3&t?e:e-4],i[t]=4>=e||4>t?n:a[0][s[n>>>24]]^a[1][s[n>>16&255]]^a[2][s[n>>8&255]]^a[3][s[255&n]]},r.cipher.aes.prototype={encrypt:function(t){return e(this,t,0)},decrypt:function(t){return e(this,t,1)},b:[[[],[],[],[],[]],[[],[],[],[],[]]],g:function(){var e,t,r,n,o,i,s,a=this.b[0],c=this.b[1],u=a[4],f=c[4],h=[],l=[];for(e=0;256>e;e++)l[(h[e]=e<<1^283*(e>>7))^e]=e;for(t=r=0;!u[t];t^=n||1,r=l[r]||1)for(i=r^r<<1^r<<2^r<<3^r<<4,i=i>>8^255&i^99,u[t]=i,f[i]=t,o=h[e=h[n=h[t]]],s=16843009*o^65537*e^257*n^16843008*t,o=257*h[i]^16843008*i,e=0;4>e;e++)a[e][t]=o=o<<24^o>>>8,c[e][i]=s=s<<24^s>>>8;for(e=0;5>e;e++)a[e]=a[e].slice(0),c[e]=c[e].slice(0)}},r.bitArray={bitSlice:function(e,t,n){return e=r.bitArray.l(e.slice(t/32),32-(31&t)).slice(1),void 0===n?e:r.bitArray.clamp(e,n-t)},extract:function(e,t,r){var n=Math.floor(-t-r&31);return(-32&(t+r-1^t)?e[t/32|0]<<32-n^e[t/32+1|0]>>>n:e[t/32|0]>>>n)&(1<<r)-1},concat:function(e,t){if(0===e.length||0===t.length)return e.concat(t);var n=e[e.length-1],o=r.bitArray.getPartial(n);return 32===o?e.concat(t):r.bitArray.l(t,o,0|n,e.slice(0,e.length-1))},bitLength:function(e){var t=e.length;return 0===t?0:32*(t-1)+r.bitArray.getPartial(e[t-1])},clamp:function(e,t){if(32*e.length<t)return e;e=e.slice(0,Math.ceil(t/32));var n=e.length;return t&=31,n>0&&t&&(e[n-1]=r.bitArray.partial(t,e[n-1]&2147483648>>t-1,1)),e},partial:function(e,t,r){return 32===e?t:(r?0|t:t<<32-e)+1099511627776*e},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(e,t){if(r.bitArray.bitLength(e)!==r.bitArray.bitLength(t))return!1;var n,o=0;for(n=0;n<e.length;n++)o|=e[n]^t[n];return 0===o},l:function(e,t,n,o){var i;for(i=0,void 0===o&&(o=[]);t>=32;t-=32)o.push(n),n=0;if(0===t)return o.concat(e);for(i=0;i<e.length;i++)o.push(n|e[i]>>>t),n=e[i]<<32-t;return i=e.length?e[e.length-1]:0,e=r.bitArray.getPartial(i),o.push(r.bitArray.partial(t+e&31,t+e>32?n:o.pop(),1)),o},n:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]}},r.codec.utf8String={fromBits:function(e){var t,n,o="",i=r.bitArray.bitLength(e);for(t=0;i/8>t;t++)0===(3&t)&&(n=e[t/4]),o+=String.fromCharCode(n>>>24),n<<=8;return decodeURIComponent(escape(o))},toBits:function(e){e=unescape(encodeURIComponent(e));var t,n=[],o=0;for(t=0;t<e.length;t++)o=o<<8|e.charCodeAt(t),3===(3&t)&&(n.push(o),o=0);return 3&t&&n.push(r.bitArray.partial(8*(3&t),o)),n}},r.codec.hex={fromBits:function(e){var t,n="";for(t=0;t<e.length;t++)n+=((0|e[t])+0xf00000000000).toString(16).substr(4);return n.substr(0,r.bitArray.bitLength(e)/4)},toBits:function(e){var t,n,o=[];for(e=e.replace(/\s|0x/g,""),n=e.length,e+="00000000",t=0;t<e.length;t+=8)o.push(0^parseInt(e.substr(t,8),16));return r.bitArray.clamp(o,4*n)}},r.codec.base64={i:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(e,t,n){var o="",i=0,s=r.codec.base64.i,a=0,c=r.bitArray.bitLength(e);for(n&&(s=s.substr(0,62)+"-_"),n=0;6*o.length<c;)o+=s.charAt((a^e[n]>>>i)>>>26),6>i?(a=e[n]<<6-i,i+=26,n++):(a<<=6,i-=6);for(;3&o.length&&!t;)o+="=";return o},toBits:function(e,t){e=e.replace(/\s|=/g,"");var n,o,i=[],s=0,a=r.codec.base64.i,c=0;for(t&&(a=a.substr(0,62)+"-_"),n=0;n<e.length;n++){if(o=a.indexOf(e.charAt(n)),0>o)throw new r.exception.invalid("this isn't base64!");s>26?(s-=26,i.push(c^o>>>s),c=o<<32-s):(s+=6,c^=o<<32-s)}return 56&s&&i.push(r.bitArray.partial(56&s,c,1)),i}},r.codec.base64url={fromBits:function(e){return r.codec.base64.fromBits(e,1,1)},toBits:function(e){return r.codec.base64.toBits(e,1)}},r.hash.sha256=function(e){this.e[0]||this.g(),e?(this.f=e.f.slice(0),this.d=e.d.slice(0),this.a=e.a):this.reset()},r.hash.sha256.hash=function(e){return(new r.hash.sha256).update(e).finalize()},r.hash.sha256.prototype={blockSize:512,reset:function(){return this.f=this.k.slice(0),this.d=[],this.a=0,this},update:function(e){"string"==typeof e&&(e=r.codec.utf8String.toBits(e));var n,o=this.d=r.bitArray.concat(this.d,e);for(n=this.a,e=this.a=n+r.bitArray.bitLength(e),n=512+n&-512;e>=n;n+=512)t(this,o.splice(0,16));return this},finalize:function(){var e,n=this.d,o=this.f,n=r.bitArray.concat(n,[r.bitArray.partial(1,1)]);for(e=n.length+2;15&e;e++)n.push(0);for(n.push(Math.floor(this.a/4294967296)),n.push(0|this.a);n.length;)t(this,n.splice(0,16));return this.reset(),o},k:[],e:[],g:function(){function e(e){return 4294967296*(e-Math.floor(e))|0}var t,r=0,n=2;e:for(;64>r;n++){for(t=2;n>=t*t;t++)if(0===n%t)continue e;8>r&&(this.k[r]=e(Math.pow(n,.5))),this.e[r]=e(Math.pow(n,1/3)),r++}}},r.misc.hmac=function(e,t){this.j=t=t||r.hash.sha256;var n,o=[[],[]],i=t.prototype.blockSize/32;for(this.c=[new t,new t],e.length>i&&(e=t.hash(e)),n=0;i>n;n++)o[0][n]=909522486^e[n],o[1][n]=1549556828^e[n];this.c[0].update(o[0]),this.c[1].update(o[1]),this.h=new t(this.c[0])},r.misc.hmac.prototype.encrypt=r.misc.hmac.prototype.mac=function(e){if(this.m)throw new r.exception.invalid("encrypt on already updated hmac called!");return this.update(e),this.digest(e)},r.misc.hmac.prototype.reset=function(){this.h=new this.j(this.c[0]),this.m=!1},r.misc.hmac.prototype.update=function(e){this.m=!0,this.h.update(e)},r.misc.hmac.prototype.digest=function(){var e=this.h.finalize(),e=new this.j(this.c[1]).update(e).finalize();return this.reset(),e},r.misc.pbkdf2=function(e,t,n,o,i){if(n=n||1e3,0>o||0>n)throw r.exception.invalid("invalid params to pbkdf2");"string"==typeof e&&(e=r.codec.utf8String.toBits(e)),"string"==typeof t&&(t=r.codec.utf8String.toBits(t)),i=i||r.misc.hmac,e=new i(e);var s,a,c,u,f=[],h=r.bitArray;for(u=1;32*f.length<(o||1);u++){for(i=s=e.encrypt(h.concat(t,[u])),a=1;n>a;a++)for(s=e.encrypt(s),c=0;c<s.length;c++)i[c]^=s[c];f=f.concat(i)}return o&&(f=h.clamp(f,o)),f},r}),r("client/lib/hawk",["sjcl"],function(e){var t={};return t.client={header:function(e,r,n){var o={field:"",artifacts:{}};if(!e||"string"!=typeof e&&"object"!=typeof e||!r||"string"!=typeof r||!n||"object"!=typeof n)return o.err="Invalid argument type",o;var i=n.timestamp||Math.floor((t.utils.now()+(n.localtimeOffsetMsec||0))/1e3),s=n.credentials;if(!(s&&s.id&&s.key&&s.algorithm))return o.err="Invalid credential object",o;if(-1===t.utils.baseIndexOf(t.crypto.algorithms,s.algorithm))return o.err="Unknown algorithm",o;"string"==typeof e&&(e=t.utils.parseUri(e));var a={ts:i,nonce:n.nonce||t.utils.randomString(6),method:r,resource:e.relative,host:e.hostname,port:e.port,hash:n.hash,ext:n.ext,app:n.app,dlg:n.dlg};o.artifacts=a,!a.hash&&n.hasOwnProperty("payload")&&(a.hash=t.crypto.calculatePayloadHash(n.payload,s.algorithm,n.contentType));var c=t.crypto.calculateMac("header",s,a),u=null!==a.ext&&void 0!==a.ext&&""!==a.ext,f='Hawk id="'+s.id+'", ts="'+a.ts+'", nonce="'+a.nonce+(a.hash?'", hash="'+a.hash:"")+(u?'", ext="'+t.utils.escapeHeaderAttribute(a.ext):"")+'", mac="'+c+'"';return a.app&&(f+=', app="'+a.app+(a.dlg?'", dlg="'+a.dlg:"")+'"'),o.field=f,o},authenticate:function(e,r,n,o){if(o=o||{},e.getResponseHeader("www-authenticate")){var i=t.utils.parseAuthorizationHeader(e.getResponseHeader("www-authenticate"),["ts","tsm","error"]);if(!i)return!1;if(i.ts){var s=t.crypto.calculateTsMac(i.ts,r);if(s!==i.tsm)return!1;t.utils.setNtpOffset(i.ts-Math.floor((new Date).getTime()/1e3))}}if(!e.getResponseHeader("server-authorization")&&!o.required)return!0;var a=t.utils.parseAuthorizationHeader(e.getResponseHeader("server-authorization"),["mac","ext","hash"]);if(!a)return!1;var c={ts:n.ts,nonce:n.nonce,method:n.method,resource:n.resource,host:n.host,port:n.port,hash:a.hash,ext:a.ext,app:n.app,dlg:n.dlg},u=t.crypto.calculateMac("response",r,c);if(u!==a.mac)return!1;if(!o.hasOwnProperty("payload"))return!0;if(!a.hash)return!1;var f=t.crypto.calculatePayloadHash(o.payload,r.algorithm,e.getResponseHeader("content-type"));return f===a.hash},message:function(e,r,n,o){if(!e||"string"!=typeof e||!r||"number"!=typeof r||null===n||void 0===n||"string"!=typeof n||!o||"object"!=typeof o)return null;var i=o.timestamp||Math.floor((t.utils.now()+(o.localtimeOffsetMsec||0))/1e3),s=o.credentials;if(!(s&&s.id&&s.key&&s.algorithm))return null;if(-1===t.crypto.algorithms.indexOf(s.algorithm))return null;var a={ts:i,nonce:o.nonce||t.utils.randomString(6),host:e,port:r,hash:t.crypto.calculatePayloadHash(n,s.algorithm)},c={id:s.id,ts:a.ts,nonce:a.nonce,hash:a.hash,mac:t.crypto.calculateMac("message",s,a)};return c},authenticateTimestamp:function(e,r,n){var o=t.crypto.calculateTsMac(e.ts,r);return o!==e.tsm?!1:(n!==!1&&t.utils.setNtpOffset(e.ts-Math.floor((new Date).getTime()/1e3)),!0)}},t.crypto={headerVersion:"1",algorithms:["sha1","sha256"],calculateMac:function(r,n,o){var i=t.crypto.generateNormalizedString(r,o),s=new e.misc.hmac(n.key,e.hash.sha256);return s.update(i),e.codec.base64.fromBits(s.digest())},generateNormalizedString:function(e,r){var n="hawk."+t.crypto.headerVersion+"."+e+"\n"+r.ts+"\n"+r.nonce+"\n"+(r.method||"").toUpperCase()+"\n"+(r.resource||"")+"\n"+r.host.toLowerCase()+"\n"+r.port+"\n"+(r.hash||"")+"\n";return r.ext&&(n+=r.ext.replace("\\","\\\\").replace("\n","\\n")),n+="\n",r.app&&(n+=r.app+"\n"+(r.dlg||"")+"\n"),n},calculatePayloadHash:function(r,n,o){var i=new e.hash.sha256;return i.update("hawk."+t.crypto.headerVersion+".payload\n").update(t.utils.parseContentType(o)+"\n").update(r||"").update("\n"),e.codec.base64.fromBits(i.finalize())},calculateTsMac:function(r,n){var o=new e.misc.hmac(n.key,e.hash.sha256);return o.update("hawk."+t.crypto.headerVersion+".ts\n"+r+"\n"),e.codec.base64.fromBits(o.digest())}},t.utils={storage:{_cache:{},setItem:function(e,r){t.utils.storage._cache[e]=r},getItem:function(e){return t.utils.storage._cache[e]}},setStorage:function(e){var r=t.utils.getNtpOffset()||0;t.utils.storage=e,t.utils.setNtpOffset(r)},setNtpOffset:function(e){try{t.utils.storage.setItem("hawk_ntp_offset",e)}catch(r){console.error("[hawk] could not write to storage."),console.error(r)}},getNtpOffset:function(){return parseInt(t.utils.storage.getItem("hawk_ntp_offset")||"0",10)},now:function(){return(new Date).getTime()+t.utils.getNtpOffset()},escapeHeaderAttribute:function(e){return e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"')},parseContentType:function(e){return e?e.split(";")[0].replace(/^\s+|\s+$/g,"").toLowerCase():""},parseAuthorizationHeader:function(e,t){if(!e)return null;var r=e.match(/^(\w+)(?:\s+(.*))?$/);if(!r)return null;var n=r[1];if("hawk"!==n.toLowerCase())return null;var o=r[2];if(!o)return null;var i={},s=o.replace(/(\w+)="([^"\\]*)"\s*(?:,\s*|$)/g,function(e,r,n){return-1===t.indexOf(r)||null===n.match(/^[ \w\!#\$%&'\(\)\*\+,\-\.\/\:;<\=>\?@\[\]\^`\{\|\}~]+$/)||i.hasOwnProperty(r)?void 0:(i[r]=n,"")});return""!==s?null:i},randomString:function(e){for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",r=t.length,n=[],o=0;e>o;++o)n[o]=t[Math.floor(Math.random()*r)];return n.join("")},baseIndexOf:function(e,t,r){for(var n=(r||0)-1,o=e?e.length:0;++n<o;)if(e[n]===t)return n;return-1},parseUri:function(e){for(var t=["source","protocol","authority","userInfo","user","password","hostname","port","resource","relative","pathname","directory","file","query","fragment"],r=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?(((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?)(?:#(.*))?)/,n=r.exec(e),o={},i=15;i--;)o[t[i]]=n[i]||"";return(null===o.port||""===o.port)&&(o.port="http"===o.protocol.toLowerCase()?"80":"https"===o.protocol.toLowerCase()?"443":""),o}},t}),function(e){"undefined"!=typeof module&&module&&module.exports?module.exports=e():"function"==typeof r&&r.amd?r("p",e):P=e()}(function(){function e(){for(;v.n;){v=v.n;var e=v.f;v.f=null,e()}b=!1}function t(e){return"object"===e||"function"===e}function r(e,t){for(var r=0,n=e.length;n>r;++r)r in e&&t(e[r],r)}function n(e){try{if(!o.onerror)throw e;o.onerror(e)}catch(t){setTimeout(function(){throw t},0)}}function o(e){return e instanceof h?e:a(new h,e)}function i(e,t,n){return e._state?e:(e._state=t,e._value=n,e._pending.length>0&&r(e._pending,_),e._pending=null,e)}function s(e,t){e._pending.push(t)}function a(e,t){return e._state?e:(t instanceof h?t===e?i(e,A,new TypeError("You can't resolve a promise with itself")):t._state?i(e,t._state,t._value):s(t,function(){i(e,t._state,t._value)}):t!==Object(t)?i(e,B,t):_(function(){var r=c(e);try{var n=t.then;"function"==typeof n?k.call(n,t,r.resolve,r.reject):i(e,B,t)}catch(o){r.reject(o)}}),e)}function c(e){var t=!1;return{promise:e,resolve:function(r){t||(t=!0,a(e,r))},reject:function(r){t||(t=!0,i(e,A,r))}}}function u(){return c(new h)}function f(e){return i(new h,A,e)}function h(){this._state=0,this._value=void 0,this._pending=[]}function l(e){function t(t){return e(t,[])}function r(e){return o(e).then(t)}return r._=e,r}function p(e,t){var n=0,a=new h;return r(e,function(e,r){var c=o(e);c._state===S?(++n,s(c,function(){t[r]=c.inspect(),0===--n&&i(a,B,t)})):t[r]=c.inspect()}),0===n&&i(a,B,t),a}function d(e,t){var n=0,i=u();return r(e,function(e,r){var s=o(e);s._state===B?t[r]=s._value:(++n,s.then(function(e){t[r]=e,0===--n&&i.resolve(t)},i.reject))}),0===n&&i.resolve(t),i.promise}function g(e){function t(t){return x.apply(e,t)}return function(){var e=d(arguments,[]);return d([this,e],[]).then(t)}}var y,m,v={f:null,n:null},w=v,b=!1,T=t(typeof window)&&window||t(typeof worker)&&worker,k=t.call,x=t.apply,_=function(t){w=w.n={f:t,n:null},b||(b=!0,m(e,0))};t(typeof process)&&process&&process.nextTick?m=process.nextTick:t(typeof setImmediate)?m=T?function(e){T.setImmediate(e)}:function(e){setImmediate(e)}:t(typeof MessageChannel)?(y=new MessageChannel,y.port1.onmessage=e,m=function(){y.port2.postMessage(0)}):(m=setTimeout,T&&t(typeof Image)&&Image&&!function(){var e=0,t=function(e){var t=new Image;t.onerror=e,t.src="data:image/png,"};try{t(function(){0===--e&&(m=t)}),++e}catch(r){}e&&setTimeout(function(){e=0},0)}());var S=0,B=1,A=2;return o.defer=u,o.reject=f,h.prototype.then=function(e,t){function r(){var e,t=c._state===B?n:o;if(null!==t){try{e=t(c._value)}catch(r){return void i(u,A,r)}a(u,e)}else i(u,c._state,c._value)}var n="function"==typeof e?e:null,o="function"==typeof t?t:null,c=this,u=new h;return c._state===S?s(c,r):_(r),u},h.prototype.done=function(e,t){var r=this;(e||t)&&(r=r.then(e,t)),r.then(null,n)},h.prototype.fail=function(e){return this.then(null,e)},h.prototype.spread=function(e,t){return this.then(e&&function(r){return d(r,[]).then(function(t){return x.call(e,void 0,t)},t)},t)},h.prototype.timeout=function(e,t){var r=this,n=new h;if(r._state!==S)i(n,r._state,r._value);else{var o=setTimeout(function(){i(n,A,new Error(t||"Timed out after "+e+" ms"))},e);s(r,function(){clearTimeout(o),i(n,r._state,r._value)})}return n},h.prototype.delay=function(e){var t=u();return this.then(function(r){setTimeout(function(){t.resolve(r)},e)},t.reject),t.promise},h.prototype.inspect=function(){switch(this._state){case S:return{state:"pending"};case B:return{state:"fulfilled",value:this._value};case A:return{state:"rejected",reason:this._value};default:throw new TypeError("invalid state")}},o.allSettled=l(p),o.all=l(d),o.promised=g,o.onerror=null,o.nextTick=function(e){_(function(){try{e()}catch(t){setTimeout(function(){throw t},0)}})},o}),r("client/lib/errors",[],function(){return{INVALID_TIMESTAMP:111,INCORRECT_EMAIL_CASE:120}}),r("client/lib/request",["./hawk","p","./errors"],function(e,t,r){function n(e,t,r){r||(r={}),this.baseUri=e,this._localtimeOffsetMsec=r.localtimeOffsetMsec,this.xhr=t||XMLHttpRequest}return n.prototype.send=function(n,o,i,s,a){var c,u=t.defer(),f=new this.xhr,h=this.baseUri+n,l=this;a=a||{},s&&(c=JSON.stringify(s));try{f.open(o,h)}catch(p){u.reject({error:"Unknown error",message:p.toString(),errno:999})}if(f.onreadystatechange=function(){if(4===f.readyState){var e=f.responseText;try{e=JSON.parse(f.responseText)}catch(t){}if(e.errno){if(e.errno!==r.INVALID_TIMESTAMP||a.retrying)return u.reject(e);var c=e.serverTime;return l._localtimeOffsetMsec=1e3*c-(new Date).getTime(),a.retrying=!0,l.send(n,o,i,s,a).then(u.resolve,u.reject)}if("undefined"==typeof f.status||200!==f.status)return u.reject(e);u.resolve(e)}},i){var d=e.client.header(h,o,{credentials:i,payload:c,contentType:"application/json",localtimeOffsetMsec:this._localtimeOffsetMsec||0});f.setRequestHeader("authorization",d.field)}if(f.setRequestHeader("Content-Type","application/json"),a&&a.headers)for(var g in a.headers)f.setRequestHeader(g,a.headers[g]);return f.send(c),u.promise},n}),r("client/lib/hkdf",["sjcl","p"],function(e,t){function r(r,n,o,i){var s=new e.misc.hmac(o,e.hash.sha256);s.update(r);for(var a=s.digest(),c=32,u=Math.ceil(i/c),f=e.codec.hex.toBits(""),h="",l=0;u>l;l++){var p=new e.misc.hmac(a,e.hash.sha256),d=e.bitArray.concat(e.bitArray.concat(f,n),e.codec.utf8String.toBits(String.fromCharCode(l+1)));p.update(d),f=p.digest(),h+=e.codec.hex.fromBits(f)}var g=e.bitArray.clamp(e.codec.hex.toBits(h),8*i);return t(g)}return r}),r("client/lib/pbkdf2",["sjcl","p"],function(e,t){var r={derive:function(r,n,o,i){var s=e.misc.pbkdf2(r,n,o,i,e.misc.hmac);return t(s)}};return r}),r("client/lib/credentials",["./request","sjcl","p","./hkdf","./pbkdf2"],function(e,t,r,n,o){function i(e){return t.codec.utf8String.toBits(a+e)}function s(e,r){return t.codec.utf8String.toBits(a+e+":"+r)}var a="identity.mozilla.com/picl/v1/",c=1e3,u=256,f=t.codec.hex.toBits("00"),h=32;return{setup:function(e,r){var a={},l=s("quickStretch",e),p=t.codec.utf8String.toBits(r);return a.emailUTF8=e,a.passwordUTF8=r,o.derive(p,l,c,u).then(function(e){return a.quickStretchedPW=e,n(e,i("authPW"),f,h).then(function(t){return a.authPW=t,n(e,i("unwrapBkey"),f,h)})}).then(function(e){return a.unwrapBKey=e,a})},xor:function(e,t){for(var r=[],n=0;n<e.length;n++)r[n]=e[n]^t[n];return r},unbundleKeyFetchResponse:function(e,r){var n=this,o=t.codec.hex.toBits(r);return this.deriveBundleKeys(e,"account/keys").then(function(e){var r=t.bitArray.bitSlice(o,0,512),i=t.bitArray.bitSlice(o,-256),s=new t.misc.hmac(e.hmacKey,t.hash.sha256);if(s.update(r),!t.bitArray.equal(s.digest(),i))throw new Error("Bad HMac");var a=n.xor(t.bitArray.bitSlice(o,0,512),e.xorKey);return{kA:t.codec.hex.fromBits(t.bitArray.bitSlice(a,0,256)),wrapKB:t.codec.hex.fromBits(t.bitArray.bitSlice(a,256))}})},deriveBundleKeys:function(e,r){var o=i(r),s=t.codec.hex.toBits("");return e=t.codec.hex.toBits(e),n(e,o,s,96).then(function(e){return{hmacKey:t.bitArray.bitSlice(e,0,256),xorKey:t.bitArray.bitSlice(e,256)}})}}}),r("client/lib/hawkCredentials",["sjcl","./hkdf"],function(e,t){function r(r,s,a){var c=e.codec.hex.toBits(r),u=e.codec.utf8String.toBits(n+s);return t(c,u,i,a||96).then(function(t){var r=o(t,256,512),n=o(t,512);return{algorithm:"sha256",id:e.codec.hex.fromBits(o(t,0,256)),key:r,bundleKey:n}})}var n="identity.mozilla.com/picl/v1/",o=e.bitArray.bitSlice,i=e.codec.hex.toBits("");return r}),r("client/FxAccountClient",["./lib/request","sjcl","p","./lib/credentials","./lib/hawkCredentials","./lib/errors"],function(e,t,r,n,o,i){function s(e,t){if(!e)throw new Error("Missing "+t)}function a(t,r){"string"!=typeof t&&(r=t||{},t=r.uri),"undefined"==typeof r&&(r={}),f.test(t)||(t=t+"/"+u),this.request=new e(t,r.xhr,{localtimeOffsetMsec:r.localtimeOffsetMsec})}function c(e){s(e,"credentials"),s(e.oldUnwrapBKey,"credentials.oldUnwrapBKey"),s(e.keyFetchToken,"credentials.keyFetchToken"),s(e.passwordChangeToken,"credentials.passwordChangeToken")}var u="v1",f=new RegExp("/"+u+"$");return a.VERSION=u,a.prototype.signUp=function(e,r,o){var i=this;return s(e,"email"),s(r,"password"),n.setup(e,r).then(function(e){var r="/account/create",n={email:e.emailUTF8,authPW:t.codec.hex.fromBits(e.authPW)},s={};return o&&(o.service&&(n.service=o.service),o.redirectTo&&(n.redirectTo=o.redirectTo),o.preVerified&&(n.preVerified=o.preVerified),o.keys&&(r+="?keys=true"),o.lang&&(s.headers={"Accept-Language":o.lang})),i.request.send(r,"POST",null,n,s)})},a.prototype.signIn=function(e,r,o){var a=this;return o=o||{},s(e,"email"),s(r,"password"),n.setup(e,r).then(function(e){var n="/account/login",s={email:e.emailUTF8,authPW:t.codec.hex.fromBits(e.authPW)};return o.keys&&(n+="?keys=true"),a.request.send(n,"POST",null,s).then(function(r){return o.keys&&(r.unwrapBKey=t.codec.hex.fromBits(e.unwrapBKey)),r},function(e){if(e&&e.email&&e.errno===i.INCORRECT_EMAIL_CASE&&!o.skipCaseError)return o.skipCaseError=!0,a.signIn(e.email,r,o);throw e})})},a.prototype.verifyCode=function(e,t){return s(e,"uid"),s(t,"verify code"),this.request.send("/recovery_email/verify_code","POST",null,{uid:e,code:t})},a.prototype.recoveryEmailStatus=function(e){var t=this;return s(e,"sessionToken"),o(e,"sessionToken",64).then(function(e){return t.request.send("/recovery_email/status","GET",e)})},a.prototype.recoveryEmailResendCode=function(e,t){var r=this,n={},i={};return s(e,"sessionToken"),t&&(t.service&&(n.service=t.service),t.redirectTo&&(n.redirectTo=t.redirectTo),t.lang&&(i.headers={"Accept-Language":t.lang})),o(e,"sessionToken",64).then(function(e){return r.request.send("/recovery_email/resend_code","POST",e,n,i)})},a.prototype.passwordForgotSendCode=function(e,t){var r={email:e},n={};return s(e,"email"),t&&(t.service&&(r.service=t.service),t.redirectTo&&(r.redirectTo=t.redirectTo),t.lang&&(n.headers={"Accept-Language":t.lang})),this.request.send("/password/forgot/send_code","POST",null,r,n)},a.prototype.passwordForgotResendCode=function(e,t,r){var n=this,i={email:e},a={};return s(e,"email"),s(t,"passwordForgotToken"),r&&(r.service&&(i.service=r.service),r.redirectTo&&(i.redirectTo=r.redirectTo),r.lang&&(a.headers={"Accept-Language":r.lang})),o(t,"passwordForgotToken",64).then(function(e){return n.request.send("/password/forgot/resend_code","POST",e,i,a)})},a.prototype.passwordForgotVerifyCode=function(e,t){var r=this;return s(e,"reset code"),s(t,"passwordForgotToken"),o(t,"passwordForgotToken",64).then(function(t){return r.request.send("/password/forgot/verify_code","POST",t,{code:e})})},a.prototype.passwordForgotStatus=function(e){var t=this;return s(e,"passwordForgotToken"),o(e,"passwordForgotToken",64).then(function(e){return t.request.send("/password/forgot/status","GET",e)})},a.prototype.accountReset=function(e,r,i){var a,c=this;return s(e,"email"),s(r,"new password"),s(i,"accountResetToken"),n.setup(e,r).then(function(e){return a=t.codec.hex.fromBits(e.authPW),o(i,"accountResetToken",64)}).then(function(e){return c.request.send("/account/reset","POST",e,{authPW:a})})},a.prototype.accountKeys=function(e,r){var i=this;return s(e,"keyFetchToken"),s(r,"oldUnwrapBKey"),o(e,"keyFetchToken",96).then(function(e){var r=t.codec.hex.fromBits(e.bundleKey);return i.request.send("/account/keys","GET",e).then(function(e){return n.unbundleKeyFetchResponse(r,e.bundle)})}).then(function(e){return{kB:t.codec.hex.fromBits(n.xor(t.codec.hex.toBits(e.wrapKB),t.codec.hex.toBits(r))),kA:e.kA}})},a.prototype.accountDevices=function(e){var t=this;return s(e,"sessionToken"),o(e,"sessionToken",64).then(function(e){return t.request.send("/account/devices","GET",e)})},a.prototype.accountDestroy=function(e,r,o){var a=this;return o=o||{},s(e,"email"),s(r,"password"),n.setup(e,r).then(function(e){var n={email:e.emailUTF8,authPW:t.codec.hex.fromBits(e.authPW)};return a.request.send("/account/destroy","POST",null,n).then(function(e){return e},function(e){if(e&&e.email&&e.errno===i.INCORRECT_EMAIL_CASE&&!o.skipCaseError)return o.skipCaseError=!0,a.accountDestroy(e.email,r,o);throw e})})},a.prototype.accountStatus=function(e){return s(e,"uid"),this.request.send("/account/status?uid="+e,"GET")},a.prototype.sessionDestroy=function(e){var t=this;return s(e,"sessionToken"),o(e,"sessionToken",64).then(function(e){return t.request.send("/session/destroy","POST",e)})},a.prototype.sessionStatus=function(e){var t=this;return s(e,"sessionToken"),o(e,"sessionToken",64).then(function(e){return t.request.send("/session/status","GET",e)})},a.prototype.certificateSign=function(e,t,r){var n=this,i={publicKey:t,duration:r};return s(e,"sessionToken"),s(t,"publicKey"),s(r,"duration"),o(e,"sessionToken",64).then(function(e){return n.request.send("/certificate/sign","POST",e,i)})},a.prototype.passwordChange=function(e,t,r){var n=this;return s(e,"email"),s(t,"old password"),s(r,"new password"),n._passwordChangeStart(e,t).then(function(t){var o=t;return n._passwordChangeKeys(o).then(function(t){return n._passwordChangeFinish(e,r,o,t)})})},a.prototype._passwordChangeStart=function(e,r,o){var a=this;return o=o||{},s(e,"email"),s(r,"old password"),n.setup(e,r).then(function(e){var n={email:e.emailUTF8,oldAuthPW:t.codec.hex.fromBits(e.authPW)};return a.request.send("/password/change/start","POST",null,n).then(function(r){return r.oldUnwrapBKey=t.codec.hex.fromBits(e.unwrapBKey),r},function(e){if(e&&e.email&&e.errno===i.INCORRECT_EMAIL_CASE&&!o.skipCaseError)return o.skipCaseError=!0,a._passwordChangeStart(e.email,r,o);throw e})})},a.prototype._passwordChangeKeys=function(e){return c(e),this.accountKeys(e.keyFetchToken,e.oldUnwrapBKey)},a.prototype._passwordChangeFinish=function(e,i,a,u){var f=this;s(e,"email"),s(i,"new password"),c(a),s(u,"keys"),s(u.kB,"keys.kB");var h=n.setup(e,i),l=o(a.passwordChangeToken,"passwordChangeToken",64);return r.all([h,l]).spread(function(e,r){var o=t.codec.hex.fromBits(n.xor(t.codec.hex.toBits(u.kB),e.unwrapBKey));return f.request.send("/password/change/finish","POST",r,{wrapKb:o,authPW:t.codec.hex.fromBits(e.authPW)})})},a.prototype.getRandomBytes=function(){return this.request.send("/get_random_bytes","POST")},a}),e("client/FxAccountClient")});
//# sourceMappingURL=fxa-client.min.js.map